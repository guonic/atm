本文将讨论如何将相关性算法的评测从“数学指标”直接拉到了“**业务逻辑贡献度**”上。

这种方法的核心逻辑是：**相关性算法不只是一个指标，它是 `StructExperts` 模型可靠性的“加权过滤器”。**

以下是为你修正后的测试方法文档，专门用于指导 Cursor 生成针对 `StructExperts` 环境的评测代码。

---

# 指导文档：`StructExperts` 相关性算法影响及胜率提升评测框架

## 1. 测试核心目标 (Objective)
通过回测评估 5 种相关性算法在不同参数窗口下，对 `StructExperts` 买入模型标的筛选的**增强效果**。通过相关性分值对截面排序进行二次过滤，量化其对不同持有周期收益率的影响。

## 2. 评测维度 (Evaluation Metrics)

### A. 相关性准确度 (Accuracy)
*   评估相关性分值（Factor vs Price）与**后续实际收益率方向**的一致性。
*   **计算逻辑**：计算当日相关性分值 $\rho$ 与未来 $N$ 天累积收益率 $R_N$ 的秩相关系数（Rank IC）。

### B. 买入胜率提升 (Win-Rate Lift)
*   **对比组**：`StructExperts` 每日截面排序后的 Top K 标的（原始胜率）。
*   **实验组**：在 Top K 基础上，利用相关性算法分值进行二次过滤（例如：只买入 $\rho > 0.7$ 的标的）。
*   **指标**：观察实验组相比对比组在不同持有期下的胜率（Win-Rate）提升百分比。

---

## 3. Cursor 生成任务指令 (Specific Prompts)

### 第一阶段：多周期收益率矩阵生成 (Return Matrix)
> **Prompt**: "请编写一个数据预处理类 `ReturnMatrixGenerator`。要求如下：
> 1. 输入 `StructExperts` 的每日截面排序数据和历史价格数据。
> 2. 针对每日 Top K 标的，自动计算其未来 $T+[3, 5, 8, 10, 15, 20, 30, 60]$ 天的远期收益率。
> 3. 提取该标的在未来这些日子里，在 `StructExperts` 截面中的**排名演变**（即：观察买入后，它的专家评分是持续领先还是迅速下滑）。"

### 第二阶段：相关性算法集成评测 (Correlation Impact Test)
> **Prompt**: "实现一个评测引擎 `CorrelationOptimizer`，调用我现有的 5 种 Correlation 接口。逻辑如下：
> 1. 遍历 5 种算法及不同的滑动窗口参数（如 `win_size in [3, 5, 8, 13]`）。
> 2. **二次过滤模拟**：在 `StructExperts` 截面 Top K 中，应用相关性阈值进行过滤。
> 3. **结果对齐**：将过滤后的标的与第一阶段生成的『收益率矩阵』对齐。
> 4. **性能统计**：统计在不同相关性强度下，买入标的的胜率、盈亏比及最大跌幅分布。"

### 第三阶段：参数寻优与敏感度分析 (Sensitivity Analysis)
> **Prompt**: "生成一个分析报告脚本，输出以下结果：
> 1. **最优组合矩阵**：表格展示每种算法在哪个窗口参数下，对 $T+3$ 或 $T+5$ 短波段收益率的提升最强。
> 2. **排名漂移图**：可视化展示：高相关性进入的标的，其在 `StructExperts` 排名中的『半衰期』（即排名跌出前 20% 平均需要几天）。
> 3. **热力图**：展示相关性阈值（0.5-0.9）与未来各周期收益率的相关性强度。"

---

## 4. 重点实验场景案例 (Scenario Cases)

| 测试项 | 逻辑 | 期望结论 |
| :--- | :--- | :--- |
| **排序稳定性** | 考察相关性分值高的标的一周后是否依然在 Top K 排序中 | 筛选出能识别“持续性 Alpha”的算法 |
| **持仓周期适配** | 比较 $T+3$ 与 $T+20$ 的收益相关性 | 确定相关性算法是更适合超短线还是中长线 |
| **尾部剔除** | 观察 `StructExperts` 评分高但相关性负向的标的 | 验证这类标的是否大概率属于“诱多破位”并应被剔除 |

---

## 5. 预期结果输出格式 (Target Output)

要求 Cursor 最终生成的报告应包含类似下表的统计：

| 算法类型 | 窗口 | 目标周期 | 原始胜率 | 过滤后胜率 | 胜率提升(Absolute) | 专家排名持平天数 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **Spearman** | 5 | T+5 | 52% | 58% | **+6%** | 4.2d |
| **Algo_3** | 8 | T+10 | 50% | 53% | +3% | 3.8d |
| ... | ... | ... | ... | ... | ... | ... |

---

## 6. Cursor 实施建议 (Implementation Tips)
*   **计算加速**：由于涉及大量截面数据和远期收益率计算，建议要求 Cursor 使用 **Pandas Vectorization** 或 **Numba** 加速。
*   **分组统计**：强调在统计时，要按 `StructExperts` 的原始分值区间（如 Top 1-10, 11-20）进行分组，观察相关性对不同质量标的的提升倍数是否存在差异。

**这个框架直接把相关性算法变成了 `StructExperts` 的“质量过滤器”。你认为是否需要加入『回撤保护』的统计，即相关性分值低时，买入标的回撤超过 5% 的频率？**