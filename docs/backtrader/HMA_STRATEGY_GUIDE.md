# 赫尔均线（HMA）策略使用指南

## 策略概述

赫尔均线（Hull Moving Average，HMA）策略是一个基于HMA指标的交易系统，通过精妙的数学公式解决了传统均线滞后的问题，能够提前捕捉趋势变化。

## 核心优势

1. **减少滞后**：HMA通过三重数学计算实现"近乎零滞后"
2. **提前捕捉**：相比传统均线，HMA能提前3天捕捉主升浪
3. **提高收益**：回测显示HMA策略收益比EMA策略高12.6个百分点
4. **过滤噪音**：通过趋势过滤和成交量确认，减少假信号

## HMA计算原理

### 三重数学魔法

1. **第一步：双周期加权，捕捉市场节奏**
   - 计算半周期WMA（如HMA(20)中的10日）和全周期WMA（20日）
   - 半周期WMA灵敏反映近期价格变化
   - 全周期WMA锚定长期趋势方向

2. **第二步：构建未来投影，消除滞后核心**
   - 使用公式：`2×WMA(n/2) - WMA(n)`
   - 创建"去滞后"的价格序列
   - 通过放大近期价格变化的影响，抵消传统均线的滞后性

3. **第三步：平滑处理，过滤市场噪音**
   - 对上述结果进行平方根周期的WMA平滑
   - 如HMA(20)采用√20≈4.5周期WMA
   - 确保指标在减少滞后的同时保持平滑

## 买入信号（三重确认）

**所有条件必须同时满足**：

1. **HMA由平走或下拐转为明确上翘**
   - HMA斜率超过阈值（默认约30度）
   - 之前HMA是平走或下拐状态
   - HMA值明显增加

2. **价格位于HMA之上**
   - 当前价格 > HMA值
   - 回调时不破HMA（或短暂跌破后快速收回）

3. **成交量温和放大**
   - 成交量 ≥ 前5日均量的150%（量比≥1.5）
   - 确认资金进场

### 趋势过滤（可选）

- **布林带过滤**：价格在布林带中轨之上，且布林带向上开口
- **MACD过滤**：MACD在零轴之上，或出现MACD金叉

## 卖出信号

### 预警信号（减仓30%-50%）

- **HMA由上升转为走平**
- **HMA斜率明显减小**
- 此时考虑减仓30%-50%

### 离场信号（立即清仓）

- **价格跌破HMA**
- **HMA开始下拐**
- 立即清仓

### 止损信号

- **价格跌破HMA下方1%-2%**
- 在强势行情中可将止损设在HMA下方1%-2%

## 周期设置

根据交易风格选择HMA周期：

- **短线交易（1-5天）**：HMA(10) 或 HMA(15)，灵敏度高
- **波段操作（1-3个月）**：HMA(20) 或 HMA(30)，平衡灵敏与稳定
- **长线投资（6个月以上）**：HMA(50) 或 HMA(100)，过滤短期波动

## 避坑点

### 1. 震荡市中单独使用HMA

**问题**：HMA的优势在于趋势市场，在震荡市中频繁信号会导致多次小亏损。

**解决方案**：
- 必须结合趋势过滤指标（如布林带）
- 或结合整体市场趋势判断
- 默认启用布林带和MACD过滤

### 2. 过度追求灵敏度而缩周期

**问题**：使用过小的周期（如HMA(5)）会使HMA过于敏感，产生大量噪音。

**解决方案**：
- 初学者建议从HMA(20)开始练习
- 根据实际效果逐步调整
- 不要过度追求灵敏度

### 3. 忽视基本面盲目跟信号

**问题**：HMA是纯技术指标，无法预测基本面因素（如业绩暴雷、政策变化）。

**解决方案**：
- 必须结合基本面分析
- 避免纯技术交易的风险
- 关注公司财务状况和市场环境

## 使用示例

### 基本使用（波段操作）

```bash
python python/tools/analysis/evaluate_hma_strategy.py \
    --start-date 2023-01-01 \
    --end-date 2024-01-01 \
    --num-stocks 100 \
    --skip-market-cap-filter \
    --hma-period 20
```

### 短线交易（高灵敏度）

```bash
python python/tools/analysis/evaluate_hma_strategy.py \
    --start-date 2023-01-01 \
    --end-date 2024-01-01 \
    --num-stocks 100 \
    --skip-market-cap-filter \
    --hma-period 10 \
    --volume-threshold 1.5
```

### 长线投资（低灵敏度）

```bash
python python/tools/analysis/evaluate_hma_strategy.py \
    --start-date 2023-01-01 \
    --end-date 2024-01-01 \
    --num-stocks 100 \
    --skip-market-cap-filter \
    --hma-period 50
```

### 禁用趋势过滤（更多交易机会）

```bash
python python/tools/analysis/evaluate_hma_strategy.py \
    --start-date 2023-01-01 \
    --end-date 2024-01-01 \
    --num-stocks 100 \
    --skip-market-cap-filter \
    --no-bollinger-filter \
    --no-macd-filter
```

### 调整止损比例

```bash
python python/tools/analysis/evaluate_hma_strategy.py \
    --start-date 2023-01-01 \
    --end-date 2024-01-01 \
    --num-stocks 100 \
    --skip-market-cap-filter \
    --stop-loss-pct 0.015
```

## 策略逻辑

### 买入流程

1. 检测HMA是否向上拐头（斜率增加）
2. 验证价格是否在HMA之上
3. 验证成交量是否放大（≥1.5倍）
4. 验证趋势过滤（布林带/MACD）
5. 全部通过后买入

### 卖出流程

1. 检测止损（价格跌破HMA下方1%-2%）
2. 检测预警信号（HMA走平）→ 减仓30%-50%
3. 检测离场信号（价格跌破HMA + HMA下拐）→ 清仓

### HMA斜率计算

- 斜率 = (当前HMA值 - 前一个HMA值) / 前一个HMA值
- 正值表示上升，负值表示下降
- 斜率越大，趋势越强

## 参数说明

### HMA参数

- `hma_period`: HMA周期（默认：20）
  - 短线：10-15
  - 波段：20-30
  - 长线：50-100

### 成交量参数

- `volume_ma_period`: 成交量均线周期（默认：5）
- `volume_threshold`: 买入成交量阈值（默认：1.5 = 150%）

### 斜率参数

- `slope_threshold`: 最小斜率阈值（默认：0.52弧度 ≈ 30度）

### 过滤参数

- `use_bollinger_filter`: 使用布林带过滤（默认：True）
- `use_macd_filter`: 使用MACD过滤（默认：True）

### 止损参数

- `stop_loss_pct`: 止损百分比（默认：0.02 = 2%）

## 策略优势

1. **减少滞后**：HMA通过三重计算实现近乎零滞后
2. **提前捕捉**：相比传统均线提前3天捕捉主升浪
3. **提高收益**：回测显示收益比EMA策略高12.6个百分点
4. **过滤假信号**：趋势过滤和成交量确认
5. **灵活止损**：基于HMA的动态止损

## 策略局限性

1. **震荡市场**：在震荡市场中可能产生频繁信号
2. **周期选择**：需要根据交易风格选择合适的周期
3. **基本面依赖**：无法预测基本面因素
4. **参数敏感**：不同市场环境可能需要调整参数

## 实战案例

根据文档描述，在2024年某半导体股的实际走势中：

- **HMA表现**：HMA(20)在10月12日明显拐头向上，给出明确的趋势启动信号，在28.5元入场
- **EMA表现**：直到10月15日，当股价上涨至30.2元时，EMA才出现金叉信号，比HMA晚了整整3天，股价已上涨6%
- **最终结果**：HMA策略收益达23.5%，而EMA策略仅为10.9%，HMA策略领先12.6个百分点

## 注意事项

1. **周期选择**：根据交易风格选择合适的HMA周期
2. **趋势过滤**：在震荡市场中必须使用趋势过滤
3. **基本面分析**：不要忽视基本面，盲目跟信号
4. **止损纪律**：严格遵守止损规则，不要贪心

## 对比测试

建议同时运行HMA策略和传统EMA策略进行对比：

```bash
# HMA策略（默认参数）
python python/tools/analysis/evaluate_hma_strategy.py \
    --start-date 2023-01-01 \
    --end-date 2024-01-01 \
    --num-stocks 100 \
    --skip-market-cap-filter \
    --output results_hma.csv

# EMA策略（需要创建EMA版本策略）
# 可以修改参数进行对比
```

## 风险提示

本文内容仅为技术分析分享，不构成任何投资建议。市场有风险，投资需谨慎。

实际操作中，建议先模拟演练1-2个月，熟悉策略特性，再逐步实盘应用。同时记住，HMA是一个精确的手术刀，不是点石成金的神器，它帮助更清晰地识别趋势，但不能替代严格的仓位管理和止损纪律。

